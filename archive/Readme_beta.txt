-------------------------------------------------
-------------------------------------------------

　「VMDサイジング　ローカル版」

　　β版用追加Readme

　　　　　　　　　　　　　　　　　miu200521358

-------------------------------------------------
-------------------------------------------------

----------------------------------------------------------------
■　配布元
----------------------------------------------------------------

　・ニコニコミュニティ「miuの実験室」
　　　https://com.nicovideo.jp/community/co5387214
　・ディスコード「MMDの集い　DISCORD支部」

　※基本的にβ版は上記二箇所でのみ配布しておりますので、上記以外で見かけたらお手数ですがご連絡下さい。

----------------------------------------------------------------
■　β版をご利用いただくにあたってのお願い
----------------------------------------------------------------

・この度はβ版テスターにご応募いただき、ありがとうございます
　β版をご利用いただくのにあたって、下記点をお願いいたします。

・不具合報告、改善要望、大歓迎です。
　要望についてはお応えできるかは分かりませんが…ｗ

　・不具合報告の場合、下記をご報告ください
　　・β版の番号（必須）
　　・メッセージ欄のコピペ、ログあり版でのログ、画面キャプチャのいずれか（必須）
　　・モーションとモデルのお迎えURL（分かれば、で構いません）
　　・ご報告はコミュニティの掲示板に投稿して下さい

・β版で作ったモーションの扱いは、リリース版と同様にお願いします。
　モーション・モデルの規約の範囲内であれば、
　どこに投稿していただいても、何に利用していただいても構いません。
　自作発言と再配布だけNG。年齢制限系は検索避けよろしくです。

・β版を使ってみて良かったら、ぜひ公開して、宣伝してくださいｗ
　励みになります！公開先はどこでもOKです。
　その際に、Twitterアカウント（@miu200521358）を添えていただけたら、喜んで拝見に伺います

----------------------------------------------------------------
■　rivision
----------------------------------------------------------------

VmdSizing_6.00.00_β26 (2023/12/17)
・捩り分散
　・逆ひじ許容値を -7 -> -12 まで上限緩和
・腰統合
　・一旦コメントアウト（足位置合わせにまとめる）
・位置合わせ
　・指位置合わせ時に指にローカル軸制限を入れるよう修正
【作業予定】
位置合わせ（相互位置関係加味）、足IK親統合、捩り除去、下半身補正、上半身補正、足位置合わせ

VmdSizing_6.00.00_β25 (2023/12/17)
・腕位置合わせ
　・中間点キーフレを閾値に基づいてキーフレを追加するよう機能追加

VmdSizing_6.00.00_β24 (2023/12/17)
・最初に元モデルとモーションの組み合わせで処理対象キーフレーム行列取得するよう修正
・停止ボタン用に、exec_btn_ctrl.exec_workerにワーカー割り当てが漏れてたので追加
・つま先IK統合：新規追加
　・つま先IKの移動（足首の角度）を足IKの角度に入れる
・腕位置合わせ：新規追加
　・元モデルの手首・指先端の相対位置から理想的な位置を求めてIK処理
　・未実装：左右・複数人の相互位置関係による位置調整

VmdSizing_6.00.00_β23 (2023/12/16)
・腰統合：新規追加
　・全親統合とほぼ機能統一
　・センターに腰から回転したときの移動分を加算する
・捩り分散
　・中間点キーフレを閾値に基づいてキーフレを追加するよう機能追加
・作業中の追加補正を一旦非表示に
【作業中】
・下半身補正
・位置合わせ
・停止ボタン

VmdSizing_6.00.00_β22 (2023/12/13)
・捩り分散
　・IKで計算するよう変更
　・中間点分割チェックボックス追加
・ヘルプ機能
　・？ボタンを押下するとメッセージ欄にもう少し細かい解説を表示するよう機能追加
・IK計算
　・軸制限IKとかちょっと調整
【作業中】
・位置合わせ

VmdSizing_6.00.00_β21 (2023/12/01)
・基本ライブラリ更新
・ファイル構成変更
・IK焼き込み
　・焼き込みタイミングが固定の時は細かさスライダーを非活性に変更
・全親統合
　・全ての親に入ってる値を、全ての親の子ボーンに統合して、全ての親を削除する
【作業中】
・位置合わせ、捩り分散

VmdSizing_6.00.00_β20 (2023/11/30)
・ボタン色調整
・IK焼き込み
　・固定間隔でもFKキーを焼けるようフラグ追加
　・ファイル名生成タイミング修正

VmdSizing_6.00.00_β19 (2023/11/28)
・次に押すボタンの色を変えるように修正
・IK計算
　・軸制限ありと制限角度ありの両方がリンクボーンにある場合、制限角度ありで計算するよう判定順番変更

VmdSizing_6.00.00_β18 (2023/11/28)
・処理中断ボタンの中断対象メソッド追加
　・リスト系から要素を取得する時にも判定追加
・IK焼き込み機能
　・焼き込み対象ボーン選択機能追加
　・IK計算焼き込み対象キーフレの閾値調整機能追加
　・焼き込み閾値を超えているキーフレの前のキーフレも3F以上離れていたら登録する
　・IKボーンの位置がリンクボーンの距離合計を超えていたら警告表示
　・IK焼き込み時に付与親ボーンも加味するよう修正
　　・付与親が追加されてるボーンのキーフレがある場所も計算対象
　　・付与親ボーンの角度をリンクボーンの角度から除去する計算が間違っていたので修正
・IK計算
　・軸制限あり時の角度計算を、下記流れに修正
    1. 現在調整予定角度の全ての軸の回転を生成
    2. 1の角度をYXZの回転順でラジアン角度に分解する
    3. ジンバルロックの整合性を調整する
    4. 単位角で制限する
    5. 単位角で制限した角度に基づいた回転を生成
    6. 足ボーンなどの元々のFKの回転と5を合成する
    7. 6の全体の角度を計算する
    8. 6の角度をYXZの回転順でラジアン角度に分解する
    9. 使用する角度を決める
        a. 1の角度が単位角以内で、かつ7がジンバルロックを越えてなければ、1の角度を使う
        b. 7の角度が180度以内であれば7の角度を使う
        c. a, b に当てはまらない場合、8の角度のうち、動かす軸の角度だけ使う
    10. 角度制限がある場合、9の角度をその角度内に収める
    11. ジンバルロックの整合性を調整する
    12. 指定の軸方向に10の角度分回した回転を最終決定する
  ・軸制限なし時の角度計算を、下記流れに修正
    1. 制限角で最大変位量を制限する
    2. 足ボーンなどの元々のFKの回転と1を合成する
※サイジング側はオプション付けるとエラーになります。これから直します

VmdSizing_6.00.00_β17 (2023/11/19)
・IK焼き込み機能
　・IK計算全面的に見直し

VmdSizing_6.00.00_β16 (2023/10/28)
・指スタンス補正
　・モーションに逆行列ボーンのキーフレがなかった場合、逆行列をかけない
　・指の回転はローカルY（指の広がり）だけを参照するよう変更

VmdSizing_6.00.00_β15 (2023/10/28)
・指スタンス補正
　・指１と指先のベクトル基準で補正するよう修正

VmdSizing_6.00.00_β14 (2023/10/28)
・サイジング用モデルセットアップ
　・付与親がサイジング用モデルに移植されなかった場合、付与処理をスルーするよう判定追加

VmdSizing_6.00.00_β13 (2023/10/24)
・指スタンス補正修正
　・指先ボーンの位置判定がうまくいってなかったので修正

VmdSizing_6.00.00_β12 (2023/10/18)
・処理中断ボタンが効かなくなっていたのを修正
　・マルチスレッドで例外が発生したときに適切にキャッチ出来ていなかった
・指スタンス補正追加
　・親指０は位置合わせで調整予定
【実装済み】
　・移動補正、腕スタンス補正、指スタンス補正

VmdSizing_6.00.00_β11 (2023/10/13)
・手首位置合わせ
　・ひじの角度制限を追加（ローカル軸ベース）
　・腕IKの起点を肩中点（肩根元と腕の中間）とするよう変更
・親指０位置合わせ追加
実装済み
・移動補正、腕スタンス補正、手首位置合わせ、親指０位置合わせ

VmdSizing_6.00.00_β10 (2023/10/08)
・手首位置合わせ
　・サイジング用ボーンモデルを再構築してそれベースで処理するよう変更
　・IKの位置を原点に配置
　・システムIKの場合、IKの計算時に末端のループ件数を少なくするハンドリング追加（(loop + 1) % (lidx + 1) < lidx）
実装済み
・移動補正、腕スタンス補正、手首位置合わせ

VmdSizing_6.00.00_β09 (2023/10/07)
・IK焼き込み機能
　・焼き込み処理対象に「操作可能であること」を条件に追加

VmdSizing_6.00.00_β08 (2023/10/07)
・IK焼き込み機能
　・焼き込み結果を元のモーションに入れて出力するよう修正

VmdSizing_6.00.00_β07 (2023/10/07)
・IK焼き込み機能
　・付与ボーンがある場合、さっ引くように修正
　・足IKとつま先IKで重複していた処理を統一
　・ボーン計算時のログ追加

VmdSizing_6.00.00_β06 (2023/10/07)
・作り直し（途中）
　・移動、腕スタンス補正のみ
　・腕位置合わせは途中
・IK焼き込み機能追加（後でモーサポに移動するかも）

VmdSizing_5.01.09_β01 (2023/03/12)
・ビルド環境が変わったため、再ビルド（機能は変化なし）

VmdSizing_5.01.08_β02 (2022/11/09)
・カメラサイジングの前キーフレコピー判定処理が正常に動いてなかったので修正

VmdSizing_5.01.08_β01 (2022/11/05)
・クォータニオンのノーマライズ処理（isnanチェック）時に全てが0だった場合に1を入れないと、行列計算でnanが入ってしまうため条件追加

VmdSizing_5.01.07_β01 (2022/04/28)
・クォータニオンのノーマライズ処理（isnanチェック）時に、scalarにデフォルト1が入ってたため除去
※これが発現するのは、vpdでY=180（0.000000,1.000000,0.000000,-0.000000;）が入ってた時だけ

VmdSizing_5.01.06_β06 (2021/02/23)
・連続サイジング時に出力VMDファイル名が適切に変換されなかったのを修正
・カメラVMDのCSV出力時に回転情報が正常に出力されなかったのを修正

VmdSizing_5.01.06_β05 (2021/02/23)
・一括CSV保存時に足ＩＫオフセットが含まれていなかったのを修正

VmdSizing_5.01.06_β04 (2021/02/20)
・足ＩＫオフセットパラを足タブ・一括サイジングに追加
　※足を閉じた時に重なってしまったり、全体の移動量は変えずに個別の足ＩＫの移動量だけ調整したいといった時に使ってください
　　複数人モーションの場合、個別に指定可能ですが、あまりに大きなオフセットを指定すると、フォーメーションが崩れる場合があります。
　※足ＩＫオフセットの列を、「移動量補正」と「カメラモーションVMD」の間に追加しました。
　　これまでのシートそのままだとエラーになるので、CSVに列を追加してください。

VmdSizing_5.01.06_β03 (2021/02/20)
・移動量補正を一括サイジングに追加
　※移動量補正の列を、「腕チェックスキップ」と「カメラモーションVMD」の間に追加しました。
　　これまでのシートそのままだとエラーになるので、CSVに列を追加してください。
・腕チェックスキップON時に腕IKありチェックを行わないよう判定追加

VmdSizing_5.01.06_β02 (2021/02/19)
・足タブを追加し、全体移動量補正パラを追加

VmdSizing_5.01.06_β01 (2021/02/19)
・元モデルより変換先モデルの方が頭身が小さい場合、少しだけフォーメーションに余裕を持たせるよう調整
・一括サイジング時に、複数モーション1件だけの場合に最後の一行が余分に繰り返されていたのを修正
・一括サイジング用データCSV保存ボタンを一括パネルに追加
　→　同じサイジング設定を繰り返す場合に楽になります。

VmdSizing_5.01.05_β03 (2021/01/29)
・同名ボーンが重複していた時にエラーとしていたのを、後ろのボーンを無視して処理を継続するよう処理変更
・自身の親ボーンが自分より後に定義されていた場合にエラーとなっていたのを修正

VmdSizing_5.01.05_β02 (2021/01/26)
・カメラサイジング時に元モデルがボーンのみであった場合に頭頂頂点がなくても、上半身と首の半分の距離から頭頂位置を概算して計算するよう判定追加
・事前チェックでボーンを準標準までとそれ以外に分けて表示するよう処理追加

VmdSizing_5.01.05_β01 (2021/09/25)
・PmxTailor用にコード整理

VmdSizing_5.01.03_β04 (2021/05/22)
・腕スタンス補正
　・作成元「もしくは」変換先のモデルで手首→中指１の長さチェックに引っかかった場合、
　　作成元も変換先も、いずれも「表示先」ボーンを使用して手首の傾きを算出するよう処理変更

VmdSizing_5.01.03_β03 (2021/05/22)
・腕スタンス補正
　・手首から中指１までの長さと、中指１〜中指３までの長さ＊２のチェックに変更
　・警告文言修正

VmdSizing_5.01.03_β02 (2021/05/22)
・腕スタンス補正
　・ISAO式ミクで手首が折れるのを回避できるよう処理調整
　　（ISAO式ミクの場合、手首と中指が分断されてるので、表示先をベースに調整する）

VmdSizing_5.01.03_β01 (2021/05/13)
・変換前チェック
　・不足ボーンチェック時に、ボーンの性質等のチェックも合わせて行うよう、処理追加
・位置合わせ
　・ひじの角度が30度未満である場合、位置合わせ腕IK処理からひじを除外
　　→　これに伴いひじが逆向きに骨折する可能性が減ったはず




